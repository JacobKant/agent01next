# MCP Web Tools - Инструменты для работы с интернетом

## Описание

Добавлен новый MCP сервер `web-server.ts`, который предоставляет AI-агенту инструменты для работы с веб-ресурсами.

## Доступные инструменты

### 1. fetch_webpage

Получает содержимое веб-страницы в сжатом текстовом виде.

**Параметры:**
- `url` (string, обязательный) - URL веб-страницы
- `maxLength` (number, опциональный) - Максимальная длина текста в символах (по умолчанию 5000)

**Возможности:**
- Удаляет все HTML теги
- Извлекает только текстовое содержимое
- Автоматически сжимает большие страницы
- Поддерживает HTML entities (декодирует &nbsp;, &lt; и т.д.)

**Пример использования:**
```json
{
  "url": "https://example.com/article",
  "maxLength": 3000
}
```

**Пример ответа:**
```json
{
  "url": "https://example.com/article",
  "contentType": "text/html; charset=utf-8",
  "textLength": 15234,
  "compressedLength": 3000,
  "content": "Extracted text content..."
}
```

### 2. search_web

Выполняет поиск в интернете через DuckDuckGo API.

**Параметры:**
- `query` (string, обязательный) - Поисковый запрос
- `maxResults` (number, опциональный) - Максимальное количество результатов (по умолчанию 5)

**Возможности:**
- Получает основной ответ (Abstract) по запросу
- Возвращает связанные темы (Related Topics)
- Включает URLs для дальнейшего изучения

**Пример использования:**
```json
{
  "query": "курс доллара",
  "maxResults": 3
}
```

**Пример ответа:**
```json
{
  "query": "курс доллара",
  "resultsCount": 3,
  "results": [
    {
      "type": "abstract",
      "title": "Основной результат",
      "text": "Описание...",
      "url": "https://...",
      "source": "Wikipedia"
    },
    {
      "type": "related",
      "title": "Связанная тема",
      "text": "Описание...",
      "url": "https://..."
    }
  ]
}
```

## Архитектура

### Множественные MCP серверы

Система теперь поддерживает подключение к нескольким MCP серверам одновременно:

1. **cbr-rates-server** (`src/mcp/server.ts`)
   - Инструмент `cbr_rates` для получения курсов валют ЦБ РФ

2. **web-fetch-server** (`src/mcp/web-server.ts`)
   - Инструмент `fetch_webpage` для получения содержимого страниц
   - Инструмент `search_web` для поиска в интернете

### McpClientManager

Класс `McpClientManager` (`src/lib/mcp-client.ts`) управляет подключением к множеству MCP серверов:

- Автоматически подключается ко всем настроенным серверам
- Собирает все доступные tools из всех серверов
- Маршрутизирует вызовы tools к соответствующим серверам
- Корректно закрывает все соединения

### Интеграция

Функция `executeChatWithMCP` (`src/lib/chat-executor.ts`) автоматически:
- Получает все tools из всех подключенных MCP серверов
- Передает их в LLM (OpenRouter)
- Обрабатывает tool calls и возвращает результаты
- Поддерживает цепочку вызовов (tool → LLM → tool → LLM)

## Использование

AI-агент теперь может:
1. Искать информацию в интернете
2. Получать содержимое веб-страниц
3. Анализировать текстовую информацию с сайтов
4. Комбинировать данные из разных источников (веб + API ЦБ РФ)

**Примеры вопросов:**
- "Найди информацию о курсе биткоина"
- "Получи содержимое страницы https://example.com"
- "Что пишут в интернете про искусственный интеллект?"

## Технические детали

### Безопасность
- User-Agent маскировка для обхода простой блокировки ботов
- Проверка типа контента (только text/html и text/plain)
- Обработка ошибок HTTP и сетевых проблем

### Производительность
- Автоматическое сжатие больших страниц
- Удаление ненужных HTML элементов (scripts, styles)
- Ограничение размера результатов

### Ограничения
- DuckDuckGo API может не возвращать результаты для всех запросов
- Некоторые сайты могут блокировать автоматические запросы
- Сжатие текста может терять важную информацию из середины страницы

